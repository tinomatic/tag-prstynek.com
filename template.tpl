___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Record Sale Conversion (Shoptet)",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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AAAAIXRFWHRleGlmOkRhdGVUaW1lADIwMjE6MTI6MTAgMTE6MTI6OTVToh2jAAAAE3RFWHRleGlmOkV4aWZPZmZzZXQAMTUyDjXd4gAAABh0RVh0ZXhpZjpQaXhlbFhEaW1lbnNpb24AMjAwRHT+NAAAABh0RVh0ZXhpZjpQaXhlbFlEaW1lbnNpb24AMjAw2XsfQgAAAB50RVh0ZXhpZjpTb2Z0d2FyZQBQaXhlbG1hdG9yIDMuOS44ESVg6AAAACB0RVh0c29mdHdhcmUAaHR0cHM6Ly9pbWFnZW1hZ2ljay5vcme8zx2dAAAAGHRFWHRUaHVtYjo6RG9jdW1lbnQ6OlBhZ2VzADGn/7svAAAAGHRFWHRUaHVtYjo6SW1hZ2U6OkhlaWdodAAxOTJAXXFVAAAAF3RFWHRUaHVtYjo6SW1hZ2U6OldpZHRoADE5MtOsIQgAAAAZdEVYdFRodW1iOjpNaW1ldHlwZQBpbWFnZS9wbmc/slZOAAAAF3RFWHRUaHVtYjo6TVRpbWUAMTY0MjA3OTQ4MBEi0f4AAAAPdEVYdFRodW1iOjpTaXplADBCQpSiPuwAAABWdEVYdFRodW1iOjpVUkkAZmlsZTovLy9tbnRsb2cvZmF2aWNvbnMvMjAyMi0wMS0xMy9lM2M0YmM2OTM4OGY2YzVlNTA4MDhkOWE1ZjQyNDU4Zi5pY28ucG5nInXuwgAAAABJRU5ErkJggg\u003d\u003d"
  },
  "description": "Record orders placed by customers referred to your site by prstynek.com",
  "categories": ["AFFILIATE_MARKETING", "CONVERSIONS"],
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "apiKey",
    "displayName": "API Key",
    "simpleValueType": true,
    "alwaysInSummary": true,
    "help": "Enter your \"API key\" (refer to settings in the prstynek.com admin portal)",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "STRING_LENGTH",
        "args": [
          1,
          50
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
const queryPermission = require('queryPermission');
const copyFromDataLayer = require('copyFromDataLayer');
const injectScript = require('injectScript');
const callInWindow = require('callInWindow');
const JSON = require('JSON');

const pageType = copyFromDataLayer('shoptet.pageType');
const order = copyFromDataLayer('shoptet.order');

if (pageType == 'thankYou') {
  // On conversion page
  const scriptUrl = 'https://resources.prstynek.com/js/jslib.js';
  
  if (queryPermission('inject_script', scriptUrl)) {
    injectScript(scriptUrl, () => { 
      //
      const ptok_cookies = callInWindow('getCookies');
      if (data.debug) log('ptok_cookies', ptok_cookies);
      //
      
      let response_array = [];

      if (ptok_cookies != null) {
        if (true) {
          // Get products ordered from datalayer
          let orderItems = order.content;
          if (data.debug) log('orderItems', orderItems);
      
          for (var i = 0; i < orderItems.length; i++) {
            let itemSKU = orderItems[i].sku || '';
            let price = orderItems[i].price || 0;
            let quantity = orderItems[i].quantity || 0;
        
            if (data.debug) log('itemSKU', itemSKU, 'price', price, 'quantity', quantity);
        
            let conversionEvent = '';
            let type = 0;
        
            for (let n = 0; n < ptok_cookies.length; n++) {
              let cookie = ptok_cookies[n];
              let name = cookie.split("=")[0];
              let value = cookie.split("=")[1];
              
              if (data.debug) log('cookie name', name, 'cookie value', value);

              if (name.indexOf('ptok_') >= 0) {
                let sku = name.split('_')[1];
                
                if (data.debug) log('cookie SKU', sku, 'order item SKU', itemSKU);
                
                if (sku == itemSKU) {
                  conversionEvent = value;
                  type = 1;
                  ptok_cookies.splice(n, 1);
                }
              }
            }
        
            response_array.push({ type : type, sku : itemSKU, price : price, quantity : quantity, event : conversionEvent });  
          }
          
          if (data.debug) log('response_array', response_array);
      
          for (let m = 0; m < ptok_cookies.length; m++) {
            let cookie = ptok_cookies[m];
            let name = cookie.split("=")[0];
            let value = cookie.split("=")[1];
        
            if (name.indexOf('ptok_') >= 0) {
              let sku = name.split('_')[1];
              response_array.push({ type : 3, sku : sku, price : 0, quantity : 0, event : value });
            }
          }
      
          let message = { id : data.apiKey, items : response_array };
          let response = JSON.stringify(message);
      
          if (data.debug) log('Response', response);
      
          if (response.length > 0) {
            if (data.debug) log('Sending (post) ...');
            callInWindow('postEvent', 'https://services.prstynek.com/api/events/track', response);
          }
        }
      } 
    }, data.gtmOnFailure, scriptUrl);
  } else {
    log('Script load failed due to permissions mismatch.');
    data.gtmOnFailure();
  }
}

data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "shoptet.pageType"
              },
              {
                "type": 1,
                "string": "shoptet.product.*"
              },
              {
                "type": 1,
                "string": "shoptet.order.*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "postEvent"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "getCookies"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://resources.prstynek.com/js/jslib.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 29/05/2023, 10:19:37


